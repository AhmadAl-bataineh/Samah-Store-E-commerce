# =============================================================================
# PRODUCTION PROFILE - application-prod.yaml
# =============================================================================
# Usage: Run with --spring.profiles.active=prod
#
# Environment variables required:
#   DATABASE_URL, SPRING_DATASOURCE_USERNAME, SPRING_DATASOURCE_PASSWORD,
#   JWT_SECRET, CORS_ALLOWED_ORIGINS
# =============================================================================

server:
  port: ${PORT:8080}
  servlet:
    session:
      cookie:
        same-site: lax
        secure: true
        http-only: true

spring:
  datasource:
    url: ${DATABASE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 300000
      max-lifetime: 1200000
  jpa:
    hibernate:
      # Use update for Docker deployments - creates schema if not exists
      ddl-auto: update
    open-in-view: false
    show-sql: false
    properties:
      hibernate:
        default_schema: store
        format_sql: false
        default_batch_fetch_size: 20
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
  # Flyway disabled - using Hibernate ddl-auto for schema management
  flyway:
    enabled: false
  servlet:
    multipart:
      enabled: true
      max-file-size: 5MB
      max-request-size: 10MB

app:
  jwt:
    secret: ${JWT_SECRET}
    access-minutes: 15
    refresh-days: 14
    issuer: "samah-store"
  upload:
    dir: ${UPLOAD_DIR:/tmp/uploads}
    base-url: ${UPLOAD_BASE_URL:/uploads}
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:https://samah-store.tech,https://www.samah-store.tech}
  perf:
    slow-request-threshold-ms: 200

logging:
  level:
    root: INFO
    com.samah.store: INFO
    com.samah.store.config.RequestTimingInterceptor: WARN
    org.hibernate: WARN
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

